# ModSecurity configuration for the uniquememory edge proxy.
# Reference: https://github.com/SpiderLabs/ModSecurity

SecRuleEngine On
SecRequestBodyAccess On
SecResponseBodyAccess Off
SecResponseBodyMimeType text/plain text/html text/xml application/json
SecResponseBodyLimit 5242880

# Enable recommended defaults and OWASP Core Rule Set
Include "/etc/nginx/modsec/crs/crs-setup.conf"
Include "/etc/nginx/modsec/crs/rules/*.conf"

# Enforce blocking on obvious credential exfiltration attempts
SecRule ARGS_NAMES "(?i)(password|secret|token|api_key)" "id:400001,phase:2,deny,status:403,log,msg:'Blocked sensitive field in request parameters'"
SecRule ARGS "(?i)(ssn|social[-_ ]security|credit[-_ ]card)" "id:400002,phase:2,deny,status:403,log,msg:'Blocked sensitive data pattern in request payload'"

# Prevent overly large request bodies.
SecRequestBodyLimit 10485760
SecRequestBodyNoFilesLimit 1048576

# Audit logging
SecAuditEngine RelevantOnly
SecAuditLog /var/log/modsec_audit.log
SecAuditLogParts ABIJDEFHZ
SecAuditLogRelevantStatus "^(?:5|4(?!04))"
