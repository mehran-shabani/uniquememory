# طبقه‌بندی داده‌ها

## سطوح حساسیت
| سطح | تعریف | مثال‌ها | کنترل‌ها در MVP |
| --- | --- | --- | --- |
| **Low** | دادهٔ عمومی یا کم‌ریسک که افشای آن آسیب محدودی دارد. | تنظیمات UI، ترجیحات غذا، یادداشت‌های عمومی. | ذخیره در SQLite، دسترسی با Scope عمومی، TTL کش ۵ دقیقه. |
| **Medium** | دادهٔ شخصی که افشای آن نیازمند اطلاع‌رسانی به کاربر است. | سوابق تراکنش مالی، برنامهٔ یادگیری، یادداشت‌های خانوادگی. | نیازمند رضایت صریح و Scope مشخص، رمزگذاری at-rest، محدودیت نرخ. |
| **High** | دادهٔ حساس که افشای آن می‌تواند خسارت جدی ایجاد کند. | تاریخچه پزشکی، پروفایل روان‌شناسی، روابط خانوادگی حساس. | محدود به ایجنت‌های با نقش ویژه، MFA، ممیزی دقیق، کش ۳۰ ثانیه. |
| **Critical** | زیرمجموعهٔ high با نیاز به واکنش فوری و دسترسی محدود. | دستورالعمل اضطراری، کدهای امنیتی، وصیت‌نامه‌ها. | دسترسی رویدادی، توکن short-lived (زیر ۵ دقیقه)، هشدار بلادرنگ. |

## حوزه‌های داده
* **دادهٔ ساختار‌یافته**: JSON، کلید-مقدار؛ ذخیره در SQLite با ستون JSONB (توسعهٔ بعدی).
* **دادهٔ متنی آزاد**: یادداشت‌ها، سوابق گفتگو؛ ذخیره در فیلد متن + برش برای embedding.
* **پیوست‌ها**: فایل‌های PDF، تصویر؛ ذخیره روی فایل‌سیستم با مسیر هش‌شده.
* **متاداده**: شناسهٔ ایجنت، منبع داده، timestamp؛ نگهداری در جداول اصلی برای ممیزی.

## نگهداری و حذف
| نوع داده | نگهداری پیش‌فرض | سیاست حذف |
| --- | --- | --- |
| ورودی‌های حافظهٔ low/medium | نامحدود تا زمان درخواست کاربر | Soft delete + حذف فیزیکی پس از ۳۰ روز |
| ورودی‌های high/critical | بازبینی دوره‌ای ۱۸۰ روزه | حذف فوری با تایید دو مرحله‌ای، پاک‌سازی کش و فایل |
| داده‌های ممیزی | ۳ سال | قابل آرشیو رمزگذاری‌شده، فقط append |
| پیوست‌ها | هم‌راستا با سطح حساسیت | حذف امن (overwrite) و لاگ رویداد |

## الزامات حاکمیتی
* تمام داده‌ها در دیتاسنتر داخل کشور می‌مانند؛ انتقال خارج نیازمند قرارداد جداگانه.
* هر درخواستی برای دسترسی به دادهٔ high/critical باید در ممیزی با زمینه (context) ثبت شود.
* Data Processing Agreement برای هر شرکت امضا می‌شود و در آن سطح حساسیت مجاز ذکر شده است.

## جریان دادهٔ نمونه
1. ایجنت آموزشی دادهٔ «medium» را ثبت می‌کند.
2. سرویس Chunking آن را به قطعات ۵۱۲ توکنی تبدیل و در SQLite ذخیره می‌کند.
3. بردارها در حافظهٔ محلی (فایل) نگهداری می‌شوند تا در فاز بعد به pgvector منتقل شوند.
4. هنگام جست‌وجو، درخواست با رضایت کاربر تطبیق داده و فقط قطعات مجاز بازگردانده می‌شود.
5. اگر کاربر حذف کند، رکورد از SQLite حذف و فایل chunk نیز نابود می‌شود؛ ممیزی رویداد حذف ثبت می‌کند.
