# ADR-0001 — انتخاب پشتهٔ فنی MVP

- **وضعیت:** پذیرفته‌شده (۱۴۰۳/۰۷/۰۹)
- **زمینه:** باید MVP سرویس «حافظهٔ یکتای کاربر» را در کمتر از سه ماه با منابع محدود بسازیم. تیم فعلی شامل ۳ توسعه‌دهندهٔ بک‌اند با تجربهٔ Django، یک DevOps پاره‌وقت و بدون دسترسی به سرویس‌های ابری خارجی است. اولویت با سرعت پیاده‌سازی، سادگی عملیات و امکان مهاجرت بعدی است.

## تصمیم‌ها
1. **فریم‌ورک اصلی: Django + Django REST Framework**
   - *چرا؟* تیم تجربه دارد، اکوسیستم بالغ است، ORM قدرتمند و احراز هویت/مجوز داخلی قوی دارد.
   - *پیامد:* زمان راه‌اندازی کوتاه، امکان استفاده از admin برای پرتال داخلی. نیاز به تنظیم برای performance در آینده.
2. **پایگاه‌داده اولیه: SQLite**
   - *چرا؟* راه‌اندازی سریع، بدون وابستگی خارجی، کافی برای بار اولیهٔ MVP و تست‌های محلی.
   - *پیامد:* محدودیت در هم‌زمانی و Scale؛ برنامهٔ مهاجرت به Postgres/pgvector در فاز Pilot باید آماده باشد.
3. **کش محلی (in-process + فایل‌محور)**
   - *چرا؟* حذف نیاز به Redis/Kafka در فاز اول، ساده‌سازی توسعه و استقرار تک‌سرور.
   - *پیامد:* ریسک ناسازگاری در معماری چندنودی؛ باید مکانیزم invalidation سریع برای revoke پیاده شود.
4. **ذخیره‌سازی فایل‌سیستم برای پیوست‌ها**
   - *چرا؟* استفاده از دیسک سرور داخلی با مسیر هش‌شده، عدم وابستگی به Object Storage خارجی.
   - *پیامد:* نیاز به پشتیبان‌گیری منظم و تعیین محدودیت حجم. در فاز بعد مهاجرت به MinIO یا S3-compatible.

## گزینه‌های بررسی‌شده
* **FastAPI + Postgres + Redis**: عملکرد بهتر و async، ولی نیازمند زمان یادگیری و DevOps بیشتر.
* **Node.js + MongoDB**: توسعه سریع برای بعضی APIها، ولی تیم تجربهٔ کافی ندارد و مدل دادهٔ رابطه‌ای اهمیت دارد.

## پیامدهای بعدی
* تعریف Story برای ابزار مهاجرت SQLite→Postgres.
* پیاده‌سازی لایهٔ cache abstraction تا جایگزینی Redis بدون تغییر سرویس ممکن باشد.
* تدوین سیاست پشتیبان‌گیری فایل‌سیستم و چک‌لیست بازیابی.
