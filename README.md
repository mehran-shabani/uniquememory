# UniqueMemory

پروژهٔ **UniqueMemory** یک پلتفرم ارکستراسیون حافظهٔ یکتا برای کاربر است که با جنگو و DRF پیاده‌سازی شده تا شرکت‌ها و ایجنت‌ها بتوانند با رضایت کاربر، داده‌های ساختاری و متنی را ذخیره و بازیابی کنند. این مخزن اسکلت اصلی سرویس، ماژول‌های رضایت‌گیری، موتور سیاست دسترسی، درگاه API و مستندات معماری را کنار هم قرار می‌دهد.

## مروری بر قابلیت‌ها
- **هستهٔ حافظه**: مدل‌های `MemoryEntry` و `EntryChunk` برای نگهداری دادهٔ کاربر همراه با نسخه‌گذاری و سطوح حساسیت. سرویس جست‌وجوی هیبریدی `HybridQueryService` نتایج را با ترکیب سیگنال‌های معنایی و متنی برمی‌گرداند.【F:memory/api/views.py†L1-L53】
- **رضایت و سیاست‌ها**: مدل `Consent` و موتور `PolicyEngine` کنترل می‌کنند که هر درخواست با دامنهٔ مجاز و سطح حساسیت معتبر اجرا شود و در صورت عدم انطباق، خطای مجوز بازگردد.【F:consents/models.py†L1-L118】【F:policies/engine.py†L1-L79】
- **درگاه و امنیت**: میان‌افزار `ApiGatewayMiddleware` احراز هویت مبتنی بر کلید و محدودسازی نرخ را روی تمام مسیرهای `/api/` اعمال می‌کند. ابزار DLP در `security/dlp.py` خروجی‌ها را از نظر الگوهای حساس پالایش می‌کند.【F:gateway/middleware.py†L1-L61】【F:security/dlp.py†L1-L105】
- **زیرسامانه‌ها**: ماژول‌های `embeddings`, `graph`, `mcp`, `webhooks`, `audit` و `portal` مسیر توسعهٔ بعدی برای ایندکس برداری، گراف دانش، اتصال MCP و تجربیات کاربری را آماده کرده‌اند.

## ساختار مخزن
| مسیر | توضیح |
| --- | --- |
| `accounts/` | مدل کاربر و مدیریت احراز هویت مبتنی بر ایمیل. |
| `agents/`, `companies/`, `clients/` | مدل‌های موجودیت‌های تجاری و کلیدهای دسترسی. |
| `consents/` | چرخهٔ حیات رضایت، سیگنال‌های ابطال و ابزار دامنه‌ها. |
| `memory/` | مدل‌ها، سرویس‌ها و APIهای CRUD و جست‌وجوی حافظه. |
| `chunks/`, `embeddings/` | اجزای تقطیع و نگهداری بردارهای متنی. |
| `gateway/` | میان‌افزار و نماهای مربوط به درگاه API. |
| `policies/`, `security/` | موتور سیاست و ماژول‌های DLP و خط‌مشی‌های امنیتی. |
| `docs/` | اسناد معماری، بک‌لاگ، نقشهٔ راه و ران‌بوک‌ها. |
| `scripts/`, `deploy/` | اسکریپت‌ها و تنظیمات استقرار نمونه. |
| `tests/` | تست‌های واحد و یکپارچه (Pytest + pytest-django). |

## نقشهٔ اسناد
- `docs/architecture/vision.md` – چشم‌انداز، ارزش پیشنهادی و مسیر MVP تا GA.【F:docs/architecture/vision.md†L1-L45】
- `docs/architecture/use-cases.md` – سناریوهای کلیدی و جریان‌های کار کاربر و ایجنت.
- `docs/backlog.md` – بک‌لاگ اجرایی به تفکیک اپیک برای ساخت MVP.【F:docs/backlog.md†L1-L37】
- `docs/roadmap/` – برنامهٔ زمانی فازبندی‌شده و اولویت‌های توسعه.
- `docs/runbooks/` – ران‌بوک واکنش به رخداد امنیتی و بازیابی پس از بحران.【F:docs/runbooks/security-incident.md†L1-L32】
- `docs/security/` – سیاست‌های امنیتی و تهدیدشناسی مکمل.

## پیش‌نیازها
- Python 3.11
- ابزار پایگاه دادهٔ محلی (SQLite پیش‌فرض است؛ برای محیط‌های تولید Postgres توصیه می‌شود)
- وابستگی‌های سیستم: ساختار معمول پایتون (build-essential، virtualenv)

## راه‌اندازی سریع
1. مخزن را کلون و وارد دایرکتوری پروژه شوید.
2. محیط مجازی بسازید و فعال کنید.
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   ```
3. وابستگی‌ها را نصب کنید.
   ```bash
   pip install -r requirements.txt
   ```
4. متغیرهای محیطی را تنظیم کنید (به‌صورت محلی می‌توانید از فایل `.env` استفاده کنید):
   - `DJANGO_SECRET_KEY` (در صورت عدم تعریف، مقدار نمونهٔ توسعه استفاده می‌شود)
   - `DATABASE_URL` برای اتصال به Postgres یا سایر پایگاه‌ها (پیش‌فرض: SQLite)
5. پایگاه داده را آماده کنید.
   ```bash
   python manage.py migrate
   python manage.py createsuperuser
   ```
6. سرور توسعه را اجرا کنید.
   ```bash
   python manage.py runserver
   ```

## اجرای تست‌ها و ابزارهای کیفیت
- اجرای تست‌ها:
  ```bash
  pytest
  ```
- بررسی استایل و ایستای کد (در صورت نصب اختیاری‌ها):
  ```bash
  ruff check .
  coverage run -m pytest
  coverage report
  ```

## مسیرهای بعدی
- زیرساخت‌های برداری و گراف با جزئیات در `docs/architecture/` تشریح شده‌اند.
- برای پیاده‌سازی SDKها و Manifest MCP، از نمونه‌های `mcp/` و `webhooks/` کمک بگیرید.
- آیتم‌های آمادهٔ اجرا را در `docs/backlog.md` دنبال کنید و خروجی هر فاز را مستندسازی کنید.

## مجوز
این مخزن تحت مجوز اختصاصی است؛ برای استفادهٔ تجاری با تیم محصول هماهنگ کنید.
